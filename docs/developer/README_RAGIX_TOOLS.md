# üõ†Ô∏è RAGIX Unix Toolbox

Small, robust helpers for **sovereign / local LLMs** and agent frameworks.

This toolbox provides **predictable, safe, auditable** Unix-like operations as
standalone commands or as callable MCP tools.

---

# 1. Goals

- Avoid fragile one-liners generated by LLMs  
- Provide clean, deterministic **pipable** commands  
- Keep syntax **short** and **LLM-friendly**  
- Unified CLI: `rt <command> ...`  
- Optional JSON output for agent consumption  

---

# 2. Usage

Install:

```bash
pip install -r requirements.txt
chmod +x rt.sh rt-find.sh rt-grep.sh
export PATH="$PWD:$PATH"
```

Run:

```bash
python3 ragix_tools.py <command> ...
# or
rt <command> ...
```

------

# 3. Commands

## 3.1 File discovery ‚Äî `find`

```bash
rt find ROOT [--ext py --ext md] [--name substring] \
   [--max-depth N] [--min-size BYTES] [--max-size BYTES] \
   [--since ISO] [--until ISO] [--json]
```

Output:
 `path` ¬∑ `size_bytes` ¬∑ `mtime_iso` ¬∑ `ext`
 or JSON.

------

## 3.2 Stats ‚Äî `stats`

```bash
rt stats ROOT [--max-depth N] [--with-lines] [--by-ext] [--json]
```

Shows:

- file count
- total size
- optional line counts
- per-extension stats

------

## 3.3 Ranking ‚Äî `top`

```bash
rt top ROOT [-n 20] [--max-depth N] \
   [--by size|mtime|lines] [--ascending] [--json]
```

------

## 3.4 Line counting ‚Äî `lines`

```bash
rt lines ROOT [--max-depth N] [--ext py] \
   [--skip-binary] [--json]
```

------

## 3.5 Text search ‚Äî `grep`

Patterns inside one call = **OR**
 AND is done via piping:

```bash
# OR logic
rt grep --root . --ext py -e "TODO" -e "FIXME"

# AND logic
rt grep --root . -e password -l \
  | rt grep --from-stdin -e DEBUG -l
```

Full syntax:

```bash
rt grep --root ROOT [--ext py] [--max-depth N] \
   -e PATTERN -e PATTERN2 \
   [--regex] [-i] [--skip-binary] \
   [-l] [--max-matches-per-file N] [--json]
```

------

## 3.6 Safe replacement ‚Äî `replace`

```bash
rt replace --root ROOT [--ext md --ext py] \
   [--max-depth N] [--from-stdin] \
   --old "OLD" [--new "NEW"] \
   [--regex] [--dry-run] \
   [--no-backup] [--backup-ext ".bak"]
```

Backups by default.

------

## 3.7 Document conversion ‚Äî `doc2md`

```bash
rt doc2md INPUT... [--out-dir md_out] [--overwrite] [--json]
```

Uses `pandoc` if available:

- Ubuntu: `sudo apt-get install pandoc`
- macOS: `brew install pandoc`

------

# 4. Agent Integration (MCP / RAGIX / custom agents)

This toolbox is also available through:

```
MCP/ragix_tools_spec.json
```

It defines MCP-ready tool schemas for all commands.

Agents may call:

- `rt_find`
- `rt_stats`
- `rt_top`
- `rt_lines`
- `rt_grep`
- `rt_replace`
- `rt_doc2md`

Each exposes:

- A clean CLI command
- A strict JSON schema
- JSON output for structured consumption

------

# 5. SWE-Style Tools (v0.4)

## 5.1 Navigation ‚Äî `open` and `scroll`

**Purpose:** Systematic file viewing with 100-line windows (SWE-Agent compatible)

```bash
# Open from beginning
rt open path

# Center around specific line
rt open path:line

# Explicit range
rt open path:start-end

# Scroll up/down with 2-line overlap
rt scroll path +    # scroll down
rt scroll path -    # scroll up
```

**Features:**
- 100-line windows by default (configurable with `--chunk-size`)
- 2-line overlap between scroll operations
- State tracking via `.ragix_view_state.json` (git-ignored)
- Line numbers displayed (1-based)

**Example:**
```bash
# Find where "def compute_safety_margin" appears
rt grep "def compute_safety_margin" src/

# Jump to that line
rt open src/sim/gas_flow_model.py:123

# Scroll down to see more
rt scroll src/sim/gas_flow_model.py +
```

---

## 5.2 Single-file search ‚Äî `grep-file`

**Purpose:** Search within a specific file (vs. recursive `grep`)

```bash
rt grep-file "<pattern>" <path> [--regex] [-i] [--max-matches N]
```

**Options:**
- `--regex`: treat pattern as regular expression
- `-i, --ignore-case`: case-insensitive search
- `--max-matches N`: stop after N matches

**Output:** `line_no: matching text`

**Example:**
```bash
rt grep-file "safety_margin" src/sim/gas_flow_model.py
```

---

## 5.3 Line-based editing ‚Äî `edit` and `insert`

**Purpose:** Precise line-range edits (safer than full-file rewrites)

```bash
# Replace line range
rt edit <path> <start_line> <end_line> << 'EOF'
<new content>
EOF

# Insert before line
rt insert <path> <line> << 'EOF'
<new content>
EOF
```

**Features:**
- Automatic `.bak` backups
- Profile-aware (blocked in `safe-read-only`)
- Atomic writes via temp files
- Shows edited region preview
- Optional `--show-diff` for git diff

**Environment variables:**
- `RAGIX_AUTO_DIFF=1`: always show git diff after edits
- `UNIX_RAG_PROFILE=safe-read-only`: blocks edit operations
- `RAGIX_ENABLE_SWE=0`: disables all SWE tools

**Example:**
```bash
# Replace function implementation
rt edit src/sim/gas_flow_model.py 120 135 << 'EOF'
def compute_safety_margin(flow_rate: float, pressure: float) -> float:
    """Updated safety margin calculation (2025 specs)."""
    return max(0.0, pressure - 1.1 * flow_rate)
EOF

# Verify changes
git diff -- src/sim/gas_flow_model.py
```

---

## 5.4 Environment Variables

| Variable | Default | Purpose |
|----------|---------|---------|
| `RAGIX_ENABLE_SWE` | `1` | Enable/disable SWE tools globally |
| `RAGIX_AUTO_DIFF` | `0` | Auto-show git diff after edits |
| `UNIX_RAG_PROFILE` | `dev` | Profile: `dev`, `unsafe`, `safe-read-only` |

---

## 5.5 Profile Behavior Matrix

| Profile | Navigation (open/scroll) | Search (grep-file) | Edit (edit/insert) |
|---------|-------------------------|--------------------|--------------------|
| `dev` | ‚úÖ Full access | ‚úÖ Full access | ‚úÖ Full access |
| `unsafe` | ‚úÖ Full access | ‚úÖ Full access | ‚úÖ Full access |
| `safe-read-only` | ‚úÖ Full access | ‚úÖ Full access | ‚ùå Blocked with clear error |

---

## 5.6 SWE Workflow Best Practices

1. **Discovery phase**: Use `rt find` and `rt grep` to locate relevant code
2. **Navigation phase**: Use `rt open path:line` to jump to specific locations (from grep results)
3. **Avoid repeated scrolls**: Prefer direct jumps when line numbers are known
4. **Editing phase**: Use `rt edit`/`rt insert` for line-based changes
5. **Verification**: Run `git diff` or re-open the region to review changes

**Typical session:**
```bash
# 1. Find all occurrences
rt grep "old_function_name" src/

# 2. Jump to first occurrence
rt open src/module.py:42

# 3. Edit the range
rt edit src/module.py 42 47 << 'EOF'
def new_function_name(x):
    return x * 2
EOF

# 4. Verify
git diff -- src/module.py
```

------

# 6. Notes

- Output can be piped into other Unix commands
- JSON mode recommended for agent workflows
- Works well with **RAGIX**, **RAGGAE**, and external MCP servers
- SWE tools follow the approved conventions (see `SWE_TOOLING.md`)